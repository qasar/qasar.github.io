<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.name }}{% endif %}</title>
  
  <!-- Resource hints for performance optimization -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  
  <!-- Preload critical CSS -->
  <link rel="preload" href="{{ site.baseurl }}/style.css" as="style">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600&display=swap" crossorigin>
  <link rel="stylesheet" href="{{ site.baseurl }}/style.css" media="all">
  
  <!-- Preload hero image on homepage -->
  {% if page.url == '/' or page.url == '/index.html' %}
  <link rel="preload" href="{{ site.baseurl }}/assets/tom5t-adobe-license.png" as="image">
  {% endif %}
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for {{ site.name }}" href="{{ site.baseurl }}/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="{{ "/favicon.ico" | prepend: site.baseurl }}" >
  
  <!-- Defer Google Analytics to not block page render -->
  <script>
    // Defer GA loading until after page is interactive
    window.addEventListener('load', function() {
      setTimeout(function() {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-84410223-1', 'auto');
        ga('send', 'pageview');
      }, 100);
    });
  </script>
{% seo title=false %}
{% if page.image %}
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ site.url }}{{ page.url }}">
  <meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.name }}{% endif %}">
  <meta property="og:description" content="{{ page.description | default: site.description }}">
  <meta property="og:image" content="{{ site.url }}{{ page.image }}">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@{{ site.twitter.username }}">
  <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.name }}{% endif %}">
  <meta name="twitter:description" content="{{ page.description | default: site.description }}">
  <meta name="twitter:image" content="{{ site.url }}{{ page.image }}">
{% endif %}
</head>
<body>
  <div class="container">
    {{ content }}
  </div>
  
  <!-- Service Worker Registration for aggressive caching -->
  <!-- Only register in production (not on localhost) -->
  <script>
  // Register service worker for caching (makes repeat visits instant)
  // Only register in production - skip on localhost for development
  if ('serviceWorker' in navigator) {
    // Check if we're on localhost (development) or production
    const isLocalhost = window.location.hostname === 'localhost' || 
                        window.location.hostname === '127.0.0.1' ||
                        window.location.hostname === '';
    
    // Only register service worker in production
    if (!isLocalhost) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('{{ site.baseurl }}/sw.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful');
            
            // Check for updates periodically
            setInterval(function() {
              registration.update();
            }, 60000); // Check every minute
          })
          .catch(function(error) {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    } else {
      // Unregister any existing service workers on localhost
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for (let registration of registrations) {
          registration.unregister();
          console.log('ServiceWorker unregistered for localhost development');
        }
      });
    }
  }
  </script>
</body>
</html>
